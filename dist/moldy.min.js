!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.moldy=e()}}(function(){return function e(t,r,n){function a(s,i){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!i&&u)return u(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return a(r?r:e)},c,c.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(e,t){function r(e){return e?n(e):void 0}function n(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},r.prototype.once=function(e,t){function r(){n.off(e,r),t.apply(this,arguments)}var n=this;return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var n,a=0;a<r.length;a++)if(n=r[a],n===t||n.fn===t){r.splice(a,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r){r=r.slice(0);for(var n=0,a=r.length;a>n;++n)r[n].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],2:[function(e,t){var r=e("sc-contains"),n=e("sc-is"),a=function(e,t,o,s){var i,u=t,c=n.an.array(s)?s:[];switch(!0){case/float|integer/.test(u):u="number"}if(n.a[u](e)||"*"===u)i=e;else switch(!0){case"array"===u:try{if(n.a.string(e)&&(i=JSON.parse(e)),n.not.an.array(i))throw""}catch(l){n.not.nullOrUndefined(e)&&(i=[e])}break;case"boolean"===u:try{i=/^(true|1|y|yes)$/i.test(e.toString())?!0:void 0}catch(l){}if(n.not.a.boolean(i))try{i=/^(false|-1|0|n|no)$/i.test(e.toString())?!1:void 0}catch(l){}i=n.a.boolean(i)?i:void 0;break;case"date"===u:try{i=new Date(e),i=isNaN(i.getTime())?void 0:i}catch(l){}break;case"string"===u:try{if(i=JSON.stringify(e),n.undefined(i))throw""}catch(l){try{i=e.toString()}catch(l){}}break;case"number"===u:try{i=parseFloat(e),(n.not.a.number(i)||isNaN(i))&&(i=void 0)}catch(l){i=void 0}if(void 0!==i)switch(!0){case"integer"===t:i=parseInt(i)}break;default:try{i=a(JSON.parse(e),u)}catch(l){}}return c.length>0&&!r(c,i)&&(i=c[0]),n.not.undefined(i)?i:n.not.undefined(o)?o:null};t.exports=a},{"sc-contains":3,"sc-is":7}],3:[function(e,t){var r=function(e,t){var r=!1;return Array.isArray(e)?e.forEach(function(e){r===!1&&t===e&&(r=!0)}):Object(e)===e&&Object.keys(e).forEach(function(n){r===!1&&e[n]===t&&(r=!0)}),r};t.exports=r},{}],4:[function(e,t,r){var n="{?[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-4[0-9A-Fa-f]{3}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12}}?";r.generate=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:7&r|8).toString(16)});return t},r.match=function(e){var t=new RegExp(n,"g"),r=("string"==typeof e?e:"").match(t);return Array.isArray(r)?r:[]},r.isValid=function(e){var t=new RegExp(n);return t.test(e)}},{}],5:[function(e,t){function r(e,t,o){e="object"===n(e)?e:{},t="array"===n(t)?t:[],o="string"===n(o)?o:"";var s=t.length>0?t.shift():"",i=a.call(e,s)||void 0!==e[s],u=i?e[s]:void 0,c=n(u)===o;return t.length>0&&i?r(e[s],t,o):t.length>0||""===o?i:i&&c}var n=e("type-component"),a=Object.prototype.hasOwnProperty;t.exports=function(e,t,a){return t="string"===n(t)?t.split("."):[],r(e,t,a)}},{"type-component":6}],6:[function(e,t){var r=Object.prototype.toString;t.exports=function(e){switch(r.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array"}return null===e?"null":void 0===e?"undefined":e===Object(e)?"object":typeof e}},{}],7:[function(e,t,r){var n=e("./ises/type"),a={a:{},an:{},not:{a:{},an:{}}},o={arguments:["arguments",n("arguments")],array:["array",n("array")],"boolean":["boolean",n("boolean")],date:["date",n("date")],"function":["function","func","fn",n("function")],"null":["null",n("null")],number:["number","integer","int",n("number")],object:["object",n("object")],regexp:["regexp",n("regexp")],string:["string",n("string")],undefined:["undefined",n("undefined")],empty:["empty",e("./ises/empty")],nullorundefined:["nullOrUndefined","nullorundefined",e("./ises/nullorundefined")],guid:["guid",e("./ises/guid")]};Object.keys(o).forEach(function(e){var t=o[e].slice(0,o[e].length-1),r=o[e][o[e].length-1];t.forEach(function(e){a[e]=a.a[e]=a.an[e]=r,a.not[e]=a.not.a[e]=a.not.an[e]=function(){return r.apply(this,arguments)?!1:!0}})}),r=t.exports=a,r.type=n},{"./ises/empty":8,"./ises/guid":9,"./ises/nullorundefined":10,"./ises/type":11}],8:[function(e,t){var r=e("../type");t.exports=function(e){var t=!1;return"null"===r(e)||"undefined"===r(e)?t=!0:"object"===r(e)?t=0===Object.keys(e).length:"boolean"===r(e)?t=e===!1:"number"===r(e)?t=0===e||-1===e:("array"===r(e)||"string"===r(e))&&(t=0===e.length),t}},{"../type":12}],9:[function(e,t){var r=e("sc-guid");t.exports=function(e){return r.isValid(e)}},{"sc-guid":4}],10:[function(e,t){t.exports=function(e){return null===e||void 0===e||void 0===e}},{}],11:[function(e,t){var r=e("../type");t.exports=function(e){return function(t){return r(t)===e}}},{"../type":12}],12:[function(e,t){var r=Object.prototype.toString;t.exports=function(e){switch(r.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array"}return null===e?"null":void 0===e?"undefined":e===Object(e)?"object":typeof e}},{}],13:[function(e,t){var r=e("type-component"),n=function(){var e=Array.prototype.slice.call(arguments),t="boolean"===r(e[0])?e.shift():!1,a=e,o={};return a.forEach(function(e){"object"===r(e)&&Object.keys(e).forEach(function(a){Object.prototype.hasOwnProperty.call(e,a)&&(o[a]=t&&"object"===r(e[a])?n(t,{},o[a],e[a]):e[a])})}),o};t.exports=n},{"type-component":14}],14:[function(e,t){t.exports=e(6)},{}],15:[function(e,t){t.exports={defaults:{middlewareKey:"all"}}},{}],16:[function(e,t){var r=e("sc-is"),n=e("./config.json"),a=function(){},o=function(e,t,n){return r.not.empty(t)&&r.a.string(t)?(r.not.an.array(e[t])&&(e[t]=[]),r.a.func(n)&&e[t].push(n),e[t]):void 0},s=function(){this.functions={all:[]}};s.prototype.use=function(){var e=this,t=Array.prototype.slice.call(arguments),s=r.a.string(t[0])?t.shift():n.defaults.middlewareKey,i=r.a.func(t[0])?t.shift():a;o(e.functions,s,i)},s.prototype.middleware=function(){var e=this,t=0,s=Array.prototype.slice.call(arguments),i=r.a.string(s[0])&&r.a.func(s[1])?s.shift():n.defaults.middlewareKey,u=r.a.func(s[0])?s.shift():a;o(e.functions,i);var c=function(){var r=e.functions[i][t++],n=Array.prototype.slice.call(arguments);r?(n.push(c),r.apply(e.context,n)):u.apply(e.context,n)};c.apply(e.context,s)},s.prototype.clear=function(e){r.a.string(e)&&r.not.empty(e)?this.functions[e]=[]:this.functions={all:[]}},t.exports=function(e){var t=new s;r.an.object(e)?(Object.defineProperties(e,{use:{value:function(){return t.use.apply(t,arguments),e}},middleware:{value:function(){t.middleware.apply(t,arguments)}},useify:{value:t}}),t.context=e):r.a.fn(e)&&(e.prototype.middleware=function(){t.context=this,t.middleware.apply(t,arguments)},e.use=function(){return t.use.apply(t,arguments),this},e.useify=t)}},{"./config.json":15,"sc-is":7}],17:[function(e,t){var r=function(e){var t={},r=Array.isArray(e)?e:[],n=function(e){var n=Array.prototype.slice.call(arguments,1);return t[e]?t[e].apply(r,n):r["__"+e].apply(r,n)};return Object.defineProperties(r,{on:{value:function(e,r){t[e]=r}}}),Object.defineProperty(r,"pop",{value:function(){return n("pop",r[r.length-1])}}),Object.defineProperty(r,"__pop",{value:function(){return Array.prototype.pop.apply(r,arguments)}}),Object.defineProperty(r,"shift",{value:function(){return n("shift",r[0])}}),Object.defineProperty(r,"__shift",{value:function(){return Array.prototype.shift.apply(r,arguments)}}),["push","reverse","unshift","sort","splice"].forEach(function(e){var t={};t[e]={value:n.bind(null,e)},t["__"+e]={value:function(){return Array.prototype[e].apply(r,arguments)}},Object.defineProperties(r,t)}),r};t.exports=r},{}],18:[function(e,t){t.exports={defaults:{baseUrl:"",headers:{}}}},{}],19:[function(e,t,r){var n=e("./config.json"),a={},o=e("sc-useify");o(a);var s=e("./moldy")(n.defaults,a.middleware);a.create=function(e,t){return new s(e,t)},r=t.exports=a,r.defaults=n.defaults},{"./config.json":18,"./moldy":21,"sc-useify":16}],20:[function(e,t,r){var n=e("sc-is"),a=e("sc-cast"),o=e("sc-merge");r.attributes=function(e,t){var r;return r=n.a.string(t)?{type:t}:n.an.object(t)&&t.__moldy===!0?{type:"moldy","default":t}:t,o({name:e||"",type:"","default":null,optional:!1},r)},r.getProperty=function(e){return function(){return this.__data[e]}},r.destroyedError=function(e){var t="object"==typeof e?e:{};return new Error("The given moldy item `"+t.__name+"` has been destroyed")},r.setBusy=function(e){return function(){e.busy=!0}},r.setProperty=function(e){return function(t){var r=this,n=r.__attributes[e],o=n.type?a(t,n.type,n["default"]):t;r.__data[e]!==o&&r.emit("change",r.__data[e],o),r.__data[e]=o}},r.unsetBusy=function(e){return function(){e.busy=!1}},r.noop=function(){}},{"sc-cast":2,"sc-is":7,"sc-merge":13}],21:[function(e,t,r){var n=e("sc-cast"),a=e("emitter-component"),o=e("sc-haskey"),s=e("./helpers"),i=e("sc-is"),u=e("sc-merge"),c=e("sg-observable-array"),l=e("./request"),p=e("sc-useify");r=t.exports=function(e,t){var r=function(t,r){var a=this,o=i.an.object(r)?r:{};Object.defineProperties(a,{__moldy:{value:!0},__attributes:{value:{},writable:!0},__baseUrl:{value:n(o.baseUrl,"string",""),writable:!0},__data:{value:{},writable:!0},__destroyed:{value:!1,writable:!0},__headers:{value:u({},n(o.headers,"object",{}),n(e.headers,"object",{})),writable:!0},__key:{value:n(o.key,"string","id")||"id",writable:!0},__keyless:{value:o.keyless===!0},__name:{value:t||o.name||""},__url:{value:n(o.url,"string",""),writable:!0},busy:{value:!1,writable:!0}}),o.keyless||a.$property(a.__key),Object.keys(n(o.properties,"object",{})).forEach(function(e){a.$property(e,o.properties[e])}),a.on("presave",s.setBusy(a)),a.on("save",s.unsetBusy(a)),a.on("predestroy",s.setBusy(a)),a.on("destroy",s.unsetBusy(a)),a.on("preget",s.setBusy(a)),a.on("get",s.unsetBusy(a))};return r.prototype.__defaultMiddleware=t,r.prototype.$baseUrl=function(t){var r=this,a=n(t,"string",r.__baseUrl||"");return r.__baseUrl=a.trim().replace(/(\/|\s)+$/g,"")||e.baseUrl||"",i.not.a.string(t)?r.__baseUrl:r},r.prototype.$clear=function(){var e=this;Object.keys(e.__attributes).forEach(function(t){if(o(e[t],"__moldy","boolean")&&e[t].__moldy===!0)e[t].$clear();else if(e.__attributes[t].arrayOfAType)for(;e[t].length>0;)e[t].shift();else e[t]=e.__data[t]=void 0})},r.prototype.$clone=function(e){var t=this,n=i.an.object(e)?e:t.__data,a=new r(t.__name,{baseUrl:t.$baseUrl(),headers:t.__headers,key:t.__key,keyless:t.__keyless,url:t.__url});return Object.keys(t.__attributes).forEach(function(e){a.$property(e,u(t.__attributes[e])),i.an.array(a[e])&&i.an.array(n[e])?n[e].forEach(function(t){a[e].push(t)}):a[e]=n[e]}),a},r.prototype.$collection=function(e,t){var a=this,o=a.$url(),u="get",c=i.an.object(e)?e:{},p=i.a.func(e)?e:i.a.func(t)?t:s.noop;a.emit("precollection",{moldy:a,method:u,query:c,url:o,callback:p}),l(a,c,u,o,function(e,t){var o=n(t instanceof r||i.an.array(t)?t:null,"array",[]);a.emit("collection",e,o),p.apply(a,[e,o])})},r.prototype.$destroy=function(e){var t=this,r=t.$isDirty(),n=t.$json(),a=t.$url()+(t.__keyless?"":"/"+t[t.__key]),o="delete",u=i.a.func(e)?e:s.noop;return t.__destroyed?u.apply(t,[s.destroyedError(t)]):(t.emit("predestroy",{moldy:t,data:n,method:o,url:a,callback:u}),void(r?u.apply(t,[new Error("This moldy cannot be destroyed because it has not been saved to the server yet.")]):l(t,n,o,a,function(e,r){t.emit("destroy",e,r),t.__destroyed=!0,t[t.__key]=void 0,u.apply(t,arguments)})))},r.prototype.$data=function(e){var t=this,n=i.object(e)?e:{};return t.__destroyed?s.destroyedError(t):(Object.keys(n).forEach(function(e){t.__attributes.hasOwnProperty(e)&&(i.an.array(n[e])&&o(t.__attributes[e],"arrayOfAType","boolean")&&t.__attributes[e].arrayOfAType===!0?n[e].forEach(function(r){t[e].push(r)}):i.a.object(n[e])&&t[e]instanceof r?t[e].$data(n[e]):t[e]=n[e])}),t)},r.prototype.$get=function(e,t){var n=this,a=n.$url(),o="get",u=i.an.object(e)?e:{},c=i.a.func(e)?e:i.a.func(t)?t:s.noop;wasDestroyed=n.__destroyed,n.emit("preget",{moldy:n,method:o,query:u,url:a,callback:c}),n.__destroyed=!1,l(n,u,o,a,function(e,t){var a=t instanceof r?t:null;i.an.array(t)&&t[0]instanceof r&&(n.$data(t[0].$json()),a=n),e&&wasDestroyed&&(n.__destroyed=!0),n.emit("get",e,a),c.apply(n,[e,a])})},r.prototype.$headers=function(e){var t=this;return t.__destroyed?s.destroyedError(t):(t.__headers=i.an.object(e)?e:t.__headers,i.not.an.object(e)?t.__headers:t)},r.prototype.$isDirty=function(){return this.__destroyed?!0:i.empty(this[this.__key])},r.prototype.$isValid=function(){if(this.__destroyed)return!1;var e=this,t=!0;return Object.keys(e.__attributes).forEach(function(n){if(!e.$isDirty()||n!==e.__key){var a=e[n],s=e.__attributes[n],u=s.type,c=o(s,"arrayOfAType","boolean")?s.arrayOfAType===!0:!1,l=s.optional!==!0,p=e.__keyless?!1:c?0===a.length:i.nullOrUndefined(a),f=i.not.empty(u)&&i.a.string(u)?i.not.a[u](a):p;c&&i.not.empty(a)&&a[0]instanceof r&&a.forEach(function(e){t&&e.$isValid()===!1&&(t=!1)}),t&&l&&f&&(t=!1)}}),t},r.prototype.$json=function(){var e=this,t=e.__data,n={};return Object.keys(t).forEach(function(e){i.an.array(t[e])&&t[e][0]instanceof r?(n[e]=[],t[e].forEach(function(t){n[e].push(t.$json())})):n[e]=t[e]instanceof r?t[e].$json():t[e]}),n},r.prototype.$property=function(e,t){var a=this,u=new s.attributes(e,t),l=a[e],p=i.a.string(u.type)&&/moldy/.test(u.type),f=i.an.array(u.type),y=i.an.array(t)&&o(t[0],"properties","object"),d=i.an.array(t)&&i.a.string(t[0]),_=f&&o(u.type[0],"properties","object"),h=f&&i.a.string(u.type[0])&&i.not.empty(u.type[0]),b=o(t,"properties","object");if(!a.hasOwnProperty(e)||!a.__attributes.hasOwnProperty(e)){if((y||d)&&(u.type=t,_=y,h=d,f=!0),p)Object.defineProperty(a,e,{value:u["default"],enumerable:!0}),a.__data[e]=a[e];else if(b)Object.defineProperty(a,e,{value:new r(t.name,t),enumerable:!0}),a.__data[e]=a[e];else if(f){var v=c([]),m=h||_?u.type[0]:"*";u.arrayOfAType=!0,Object.defineProperty(a,e,{value:v,enumerable:!0}),a.__data[e]=a[e],["push","unshift"].forEach(function(e){v.on(e,function(){var t=Array.prototype.slice.call(arguments),a=[];return t.forEach(function(e){if(_){var t=new r(m.name,m),o=i.an.object(e)?e:u["default"];t.$data(o),a.push(t)}else a.push(n(e,m,u["default"]))}),v["__"+e].apply(v,a)})})}else Object.defineProperty(a,e,{get:s.getProperty(e),set:s.setProperty(e),enumerable:!0});a.__attributes[e]=u}return void 0!==l?a[e]=l:i.empty(a[e])&&u.optional===!1&&i.not.nullOrUndefined(u["default"])?a[e]=u["default"]:i.empty(a[e])&&u.optional===!1&&(a.__data[e]=f||p?a[e]:i.empty(u.type)?void 0:n(void 0,u.type)),a},r.prototype.$save=function(e){var t=this,r=t.$isDirty(),n=t.$json(),a=t.$url()+(r||t.__keyless?"":"/"+t[t.__key]),o=r?"post":"put",u=i.a.func(e)?e:s.noop;t.__destroyed=!1,t.emit("presave",{moldy:t,data:n,method:o,url:a,callback:u}),l(t,n,o,a,function(e,r){t.emit("save",e,r),u.apply(t,arguments)})},r.prototype.$url=function(e){var t=this,r=i.empty(t.$baseUrl())?"":t.$baseUrl(),n=i.empty(t.__name)?"":"/"+t.__name.trim().replace(/^\//,""),a=e||t.__url||"",o=r+n+(i.empty(a)?"":"/"+a.trim().replace(/^\//,""));return t.__url=a.trim().replace(/^\//,""),i.not.a.string(e)?o:t},a(r.prototype),p(r),r}},{"./helpers":20,"./request":22,"emitter-component":1,"sc-cast":2,"sc-haskey":5,"sc-is":7,"sc-merge":13,"sc-useify":16,"sg-observable-array":17}],22:[function(e,t){var r=e("sc-is"),n=(e("sc-cast"),e("sc-haskey"));t.exports=function(e,t,a,o,s){var i=e,u=[],c=n(t,i.__key)&&r.not.empty(t[i.__key])&&/get/.test(a),l=i.$isDirty();i.__defaultMiddleware(function(e){var t=Array.prototype.slice.call(arguments),a=e===i?null:t.shift(),o=t.shift();!a||a instanceof Error||(a=new Error("An unknown error occurred")),!a&&l&&r.object(o)&&c&&!n(o,i.__key)&&(a=new Error("The response from the server did not contain a valid `"+i.__key+"`")),!a&&l&&r.object(o)&&(i[i.__key]=o[i.__key]),a||(r.array(o)?(o.forEach(function(e){u.push(i.$clone(e))}),i=u):i.$data(o)),s&&s(a,i)},e,t,a,o)}},{"sc-cast":2,"sc-haskey":5,"sc-is":7}]},{},[19])(19)});